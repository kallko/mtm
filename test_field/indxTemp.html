<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<script>
var button = document.createElement("button");
button.textContent="Create";
button.onclick=createObj;
document.body.appendChild(button);


var but2 = document.createElement("button");
but2.textContent="Read";
but2.onclick=readObj;
document.body.appendChild(but2);


// проверяем существования префикса.
window.indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;
// НЕ ИСПОЛЬЗУЙТЕ "var indexedDB = ..." вне функции.
// также могут отличаться и window.IDB* objects: Transaction, KeyRange и тд
window.IDBTransaction = window.IDBTransaction || window.webkitIDBTransaction || window.msIDBTransaction;
window.IDBKeyRange = window.IDBKeyRange || window.webkitIDBKeyRange || window.msIDBKeyRange;
// (Mozilla никогда не создавала префиксов для объектов, поэтому window.mozIDB* не требуется проверять)

if (!window.indexedDB) {
    window.alert("Ваш браузер не поддерживат стабильную версию IndexedDB. Такие-то функции будут недоступны");
}



function createObj() {

    console.log("Start Create");
    var openRequest = indexedDB.open("test", 4);

    openRequest.onupgradeneeded = function(e) {
        console.log("Upgrading...");
        thisDB= e.target.result;


        if(!thisDB.objectStoreNames.contains("firstOS")) {
            thisDB.createObjectStore("firstOS");
            console.log("Create firstOS");
        }

        if(!thisDB.objectStoreNames.contains("secondOS")) {
            thisDB.createObjectStore("secondOS");
            console.log("create secondOS");
        }

        if(!thisDB.objectStoreNames.contains("people")) {
            thisDB.createObjectStore("people");
            console.log("create people");
        }
    }

    openRequest.onsuccess = function(e) {
        console.log("Success!");
        db = e.target.result;
        console.log("DB", db);

        var transaction = db.transaction(["people"], "readwrite");
        var store = transaction.objectStore("people");

        var person = {
            name: "Alex",
            email: "54321",
            created: "Tomorrow"
        }


        var request = store.add(person, 2);

        request.onerror = function (e) {
            console.log("Error find", e);
            //some type of error handler
        }

        request.onsuccess = function (e) {
            console.log("Woot! Did it");
        }

        person = {
            name: "Alex",
            email: "54321",
            created: "Tomorrow"
        };



//        transaction = db.transaction(["people"], "readwrite");
//        store = transaction.objectStore("people");
//        request = store.add(person, 1);
//
//
//        request.onerror = function (e) {
//            console.log("Error in second", e);
//            //some type of error handler
//        }
//
//        request.onsuccess = function (e) {
//            console.log("Woot! Did it 2 times");
//        }
    }

        openRequest.onerror = function (e) {
            console.log("Error");
            console.dir(e);
        }

}


function readObj(){


    console.log("Start Read");
    var openRequest = indexedDB.open("test", 4);

    openRequest.onupgradeneeded = function(e) {
        console.log("Upgrading...");
        thisDB= e.target.result;


        if(!thisDB.objectStoreNames.contains("firstOS")) {
            thisDB.createObjectStore("firstOS");
            console.log("Create firstOS");
        }

        if(!thisDB.objectStoreNames.contains("secondOS")) {
            thisDB.createObjectStore("secondOS");
            console.log("create secondOS");
        }

        if(!thisDB.objectStoreNames.contains("people")) {
            thisDB.createObjectStore("people");
            console.log("create people");
        }
    }

    openRequest.onsuccess = function(e) {
        console.log("Success!");
        db = e.target.result;
        console.log("DB", db);
    }

}

</script>
</body>
</html>