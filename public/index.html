<!-- получение объекта родительской формы из 1С -->
<script type="text/javascript">

    console.log("~~~~~~~~~~~~~~~~~~~~~~~init");
    var parentForm;
    var newSettings;

    //    function initialize(thisForm) {
    //        parentForm = thisForm;
    //        console.log('initialize complete', parentForm);
    ////      newSettings = parentForm._call('getConfig');
    ////      console.log("NewSettings = ", newSettings);
    //        console.log("XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX");
    //
    //
//
//    }

    function onCloseMonitoring() {


    }

//    window.onbeforeunload = function() {
//
//        return "Ku Ku";
//
//    }


</script>

<!-- файлы стилей -->
<link type="text/css" rel="stylesheet" href="./css/goldenlayout-base.css"/>
<link type="text/css" rel="stylesheet" href="./css/goldenlayout-light-theme.css"/>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css"/>
<link rel="stylesheet" href="./css/font-awesome.min.css"/>
<link rel="stylesheet" href="./css/application.css"/>
<link rel="stylesheet" href="./css/columns.css"/>
<link rel="stylesheet" href="./css/bootstrap.css"/>
<!--<link rel="stylesheet" href="./css/learning.css"/>-->


<!-- библиотеки -->
<script src="./js/vendor/jquery-2.1.4.min.js"></script>
<script src="./js/vendor/jquery-ui.min.js"></script>
<script src="./js/vendor/angular.js"></script>
<script src="./js/vendor/bootstrap.min.js"></script>
<script src="./js/vendor/goldenlayout.js"></script>
<script src="./js/vendor/bootstrap-contextmenu.js"></script>
<script src="./bower_components/angular-smart-table/dist/smart-table.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
<script src="//cdn.rawgit.com/vast-engineering/jquery-popup-overlay/1.7.10/jquery.popupoverlay.js"></script>
<script src="./js/vendor/colResizable-1.5.min.js"></script>
<script src="./js/vendor/divicon.js"></script>
<script src="./js/vendor/oms.min.js"></script>
<script src="./js/vendor/leaflet.polylineDecorator.js"></script>
<!--<script src="./bower_components/async/async.js"></script>-->



<!--Layout-->
<script src="./js/vendor/jquery.layout.min.js"></script> <!--include layout-->
<script src="./js/vendor/jquery.layout_and_plugins.min.js"></script>


<script src="./js/vendor/leaflet.polylineDecorator.js"></script>

<!-- скрипты Ангуляра  -->
<script src="./js/app.js"></script>

<script src="./js/controllers/point-index-controller.js"></script>
<script src="./js/controllers/map-controller.js"></script>
<script src="./js/controllers/notification-controller.js"></script>
<script src="./js/controllers/setting-controller.js"></script>
<script src="./js/controllers/point-view-controller.js"></script>
<script src="./js/controllers/edit-route-controller.js"></script>
<script src="./js/controllers/problem-route-controller.js"></script>
<script src="./js/controllers/close-day-controller.js"></script>
<script src="./js/controllers/point-popup-edit-controller.js"></script>
<script src="./js/controllers/statistic-controller.js"></script>

<script src="./js/filters/mtm-unique.js"></script>

<script src="./js/directives/finish-render.js"></script>
<script src="./js/directives/right-click.js"></script>
<script src="./js/directives/enter-event.js"></script>
<script src="./js/directives/tr.js"></script>

<script src="./js/services/settings.js"></script>
<script src="./js/services/statuses.js"></script>
<script src="./js/services/time-converter.js"></script>
<!--<script src="./js/learning/learning.js"></script>-->
<!--<script src="./js/learning/lessons.js"></script>-->


<!-- карта на фоне -->
<div id="map"></div>

<!-- полупрозрачное окно для отображения карты -->




<!--<div ng-show="true" ng-controller="MapController" class="section" id="edittime" style="position: absolute; left: 50px; top:350px; opacity: 100; background: dimgrey" >-->
    <!--Stop № {{currentStop[0]}}: {{currentStop[1]}} - {{currentStop[2]}} duration {{currentStop[3]}} <br>-->

    <!--<div ng-repeat="point in pointsToEdit" >-->
        <!--{{point[0]}}-->
        <!--{{point[1]}} - {{point[2]}}-->
        <!--<input type="text">-->
    <!--</div>-->
    <!--&lt;!&ndash;x point 07 09.00 : 13.00 <input type="text"> <br>&ndash;&gt;-->
    <!--&lt;!&ndash;x point 09 09.00 : 12.30 <input type="text"> <br>&ndash;&gt;-->
    <!--&lt;!&ndash;x point 11 09.00 : 12.30 <input type="text"> <br>&ndash;&gt;-->
    <!--<button ng-click="hideForm()">Confirm</button>-->

<!-- </div> -->



<!--div id = "test-popup" ng-controller = "CloseDayController" ng-show = "view">Test-popup</div-->
<!-- таблица точек доставки -->
<template type="text/html" id="template-point-table">
    <!-- полупрозрачное окно для затемнения таблицы -->
    <div class="point-table-wrapper" >
        <div class="title"  ng-show="clickOff" id="transparent-point-table-window" > <p>Загрузка...</p> </div>

    <div ng-controller="PointIndexController" class="section" id="point-controller-container">
        <!-- меню -->
        <!-- Пока не выводим для пользователя, так как не реализован функционал -->
        <div id="point-menu-panel" >
            <div class="row row-gutter-5">
                <div class="col-md-2">
                    <span>{{nowTime*1000 | date : 'dd.MM.yyyy'}}</span>
                </div>
                <div class="col-sm-3">
                    <button type="button" class="btn btn-secondary dropdown-toggle dropdown-status" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Cтатус
                    </button>
                    <div class="dropdown-menu">
                        <ul class="dropdown-statuses">
                            <li><input type="checkbox" ng-change="filtersOllstatuses()" ng-model="filters.status['-1']" >{{ filters.statuses[0].name }}</li>
                            <li ng-repeat="option in filters.statuses" ng-if="!$first" ><input ng-change="filterOnestatus()" type="checkbox" ng-model="filters.status[option.value]"> {{option.name}}</li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-3">
                    <select id="route-select"   ng-model="filters.route" class="group-select heightElement width100"
                            ng-options="option.value as option[settings.routeListOrderBy]   for option in filters.routes | orderBy : ['-allRoutes', settings.routeListOrderBy]">
                    </select>
                </div>
                <div class="col-sm-2">
                    <button  class="btn btn-default btn-sm heightElement width100" ng-class="filters.problem_index == 1 ? 'btn-success' : '' " id="problem-index-btn" ng-click="toggleProblemPoints()">
                        Проблемные
                    </button>
                </div>
                <div class="col-sm-2">
                    <button  class="btn btn-default btn-sm heightElement width100"  id="problem-solve-btn" ng-model ="filters.route" ng-click="solveProblem(filters.route)">
                        Записать
                    </button>
                </div>

            </div>
            <div class="row row-gutter-5">
                <div class="col-md-2">
                    {{nowTime*1000 | date : 'H:mm:ss'}}
                </div>
                <div class="col-sm-3">
                    <input  id="search-input" class="heightElement" type="text" size="15" enter-event="setTextFilter()"/>
                    <button  class="btn btn-info btn-sm filter-btn searchButton" ng-click="setTextFilter()">
                        <span class="glyphicon glyphicon-search" aria-hidden="false"></span>
                    </button>
                </div>
                <div class="col-sm-3">
                    <input type="date"
                           class="width100 heightElement"
                           ng-model="showDate"
                           id="show-date"/>
                </div>
                <div  class="col-sm-2">
                    <button ng-show="data.routes.length == 0" class="btn btn-info btn-sm heightElement width100" ng-click="loadOldDay()" >Загрузить</button>
                    <!--todo вставить вверх ng-show="data.routes.length == 0"-->
                </div>
            </div>
        </div>



                <select ng-show="false" id="branch-select" ng-model="filters.branch" class="group-select"
                        ng-options='option.value as option.name for option in filters.branches'>
                </select>




                <select ng-show="false" id="draw-mode-select" ng-model="draw_mode" class="group-select"
                        ng-options='option.value as option.name for option in draw_modes'>
                </select>

                <input ng-show="false" id="draw-stops" type="checkbox" checked title="Отображать стопы"/>
                <input ng-show="false" id="draw-pushes" type="checkbox" title="Отображать моб. нажатия"/>
                <button ng-show="false" class="btn btn-info btn-sm" ng-click="drawRoute()">отрисовать</button>

                <button ng-show="false" class="btn btn-info btn-sm" id="force-load-btn" ng-click="forceLoad()">
                    загрузить
                </button>



                <input ng-show="false" id="fast-calc" type="checkbox" value="false" ng-model="fastCalc" checked title="Упрощенный расчет данных">

                <button ng-show="false" class="btn btn-default btn-sm" id="promised-15m-btn" ng-click="togglePromised15MPoints()">
                    {{params.endWindowSize * 5}} минут до закрытия
                </button>
                <button ng-show="false" class="btn btn-default btn-sm1"  id="test" ng-click="testbutton()" >
                     Кнопка ТЕСТ
                </button>


                <button ng-show="false" class="btn btn-info btn-sm filter-btn" id="cancel-filter-btn" ng-click="cancelTextFilter()">
                    <span class="glyphicon glyphicon glyphicon-remove" aria-hidden="false"></span>
                </button>

            <!-- таблица точек -->
        <div class="point-table-wrap">
        <div id="point-table" class="table-holder">


            <table class="table table-striped point-table" id="point-table-tbl"
                   st-safe-src="rowCollection" st-table="displayCollection">
                <thead class="header">
                <tr class="titles-tr">
                    <th class="number-col" title="Плановый номер задания"><button ng-click="order('NUMBER')"  >План</button></th>
                    <th class="number-col" title="Фактический порядок"><button ng-click="order('fact_number')"  >Факт</button></th>
                    <th class="bulled-th"></th>
                    <th class="status-col"  title="Статус доставки">
                        <button ng-click="order('status')"  >Статус</button>
                    </th>
                    <th class="degree" title="Достоверность"></th>
                    <th class="car-type-col" title="Назавание машины">Машина</th>
                    <th class="driver-name-col" title="Фамилия и имя водителя">Водитель</th>
                    <th class="client-name-col" title="Название точки доставки">Название</th>
                    <th class="address-col" title="Адрес доставки">Адрес</th>
                    <th class="time-window-col" title="Заказанное клиентом окно">Заказанное</th>
                    <th class="plan-arrival-time-col" title="Плановое прибытие на точку">
                        <button ng-click=" order('arrival_time_ts')">План</button>
                    </th>
                    <th class="promised-window-col" title="Обещанное клиенту окно">Обещ. окно</th>
                    <th class="time-left-window-col" title="Остаток до конца контролируемого окна" >
                        <button ng-click=" order('end_time_ts')" >Ост. КОК</button>
                    </th>
                    <th class="prediction-arrival-time-col" title="Прогнозируемое время прибытия">Прогноз прибытия</th>
                    <th class="prediction-arrival-left-col"
                        title="Осталось до прогнозируемого времени прибытия" >
                        <button ng-click="order('arrival_left_prediction')">До прибытия</button>
                    </th>
                    <!--<th class="promised-window-changed-col" title="Редактируемое обещанное окно">Редакт. окно</th>-->
                    <th class="real-arrival-time-col" title="Фактическое время прибытия">Факт. прибытие</th>
                    <th class="overdue-col" title="Размер опоздания от планового времени прибытия">Опазд.</th>
                    <th class="stop-col" title="Наличие стопа связанного с точкой">Стоп</th>
                    <th class="mobile-push-col" title="Наличие нажатия с мобильного приложения">Моб.нажатие</th>
                    <th class="gps-conf-col" title="Подтверждение точки GPS">GPS</th>
                    <th class="promised-window-changed-col" title="Количество переносов">Переносов</th>
                    <th class="window-type-col" title="Фактическое окно доставки">Факт. окно</th>
                    <th class="car-number-col" title="Номер машины">Номер</th>
                    <th class="driver-phone-col" title="Телефон водителя">Тел. водителя</th>
                    <th class="branch-col" title="Филиал">Филиал</th>
                    <th class="problem-index-col"  title="Индекс проблемности задания">
                        <button ng-click="order('problem_index')">Проблемность</button>
                    </th>
                    <th class="comment-col" title="Комментарий к точке">Комментарий</th>
                </tr>
                </thead>

                <thead class="header-copy">
                <tr class="titles-tr">
                    <th class="number-col" title="Плановый номер задания"><button ng-click="order('NUMBER')"  >План</button></th>
                    <th class="number-col" title="Фактический порядок"><button ng-click="order('fact_number')"  >Факт</button></th>
                    <th class="bulled-th"></th>
                    <th class="status-col"  title="Статус доставки">
                        <button ng-click="order('status')"  >Статус</button>
                    </th>
                    <th class="degree" title="Достоверность">%</th>
                    <th class="car-type-col" title="Назавание машины">Машина</th>
                    <th class="driver-name-col" title="Фамилия и имя водителя">Водитель</th>
                    <th class="client-name-col" title="Название точки доставки">Название</th>
                    <th class="address-col" title="Адрес доставки">Адрес</th>
                    <th class="time-window-col" title="Заказанное клиентом окно">Заказанное</th>
                    <th class="plan-arrival-time-col" title="Плановое прибытие на точку">
                        <button ng-click=" order('arrival_time_ts')">План</button>
                    </th>
                    <th class="promised-window-col" title="Обещанное клиенту окно">Обещ. окно</th>
                    <th class="time-left-window-col" title="Остаток до конца контролируемого окна" >
                        <button ng-click=" order('end_time_ts')" >Ост. КОК</button>
                    </th>
                    <th class="prediction-arrival-time-col" title="Прогнозируемое время прибытия">Прогноз прибытия</th>
                    <th class="prediction-arrival-left-col"
                        title="Осталось до прогнозируемого времени прибытия" >
                        <button ng-click="order('arrival_left_prediction')">До прибытия</button>
                    </th>
                    <!--<th class="promised-window-changed-col" title="Редактируемое обещанное окно">Редакт. окно</th>-->
                    <th class="real-arrival-time-col" title="Фактическое время прибытия">Факт. прибытие</th>
                    <th class="overdue-col" title="Размер опоздания от планового времени прибытия">Опазд.</th>
                    <th class="stop-col" title="Наличие стопа связанного с точкой">Стоп</th>
                    <th class="mobile-push-col" title="Наличие нажатия с мобильного приложения">Моб.нажатие</th>
                    <th class="gps-conf-col" title="Подтверждение точки GPS">GPS</th>
                    <th class="promised-window-changed-col" title="Количество переносов">Переносов</th>
                    <th class="window-type-col" title="Фактическое окно доставки">Факт. окно</th>
                    <th class="car-number-col" title="Номер машины">Номер</th>
                    <th class="driver-phone-col" title="Телефон водителя">Тел. водителя</th>
                    <th class="branch-col" title="Филиал">Филиал</th>
                    <th class="problem-index-col"  title="Индекс проблемности задания">
                        <button ng-click="order('problem_index')">Проблемность</button>
                    </th>
                    <th class="comment-col" title="Комментарий к точке">Комментарий</th>
                </tr>
                </thead>

                <tbody 
                    ng-click="rowClick($event)"
                    ng-dblclick="dblRowClick($event)"
                    >

                <tr ng-repeat="row in displayCollection | orderBy : myFilter" 
                    id="{{::'point-' + row.row_id}}"
                    on-finish-render="ngRepeatFinished"
                    ng-if="applyFilter(row)"
                    ng-class="{'selected-row' : row.selected}"
                        >
                    <!--class="delivery-point-row"-->


                    <!--'row-red': row.locked, 'row-green' : row.lockedByMe,  -->
                    <td class="number-col">{{row.NUMBER}}</td>
                    <td class="number-col">{{row.fact_number}}</td>
                    <td ng-class="[row.class, row.class2]" class="bulled-th" ><span>&#9899;</span></td>
                    <td class="status-col" ng-class="row.class" >
                             <span>
                                {{getTextStatus(row)}}
                            </span>
                    </td>
                    <td class="degree"  >
                        <span>
                          {{row.limit}}
                        </span>
                    </td>
                    <td class="car-type-col" title="{{::row.transport.NAME}}" >{{row.transport.NAME}}</td>
                    <td class="driver-name-col">{{row.driver.NAME}}</td>
                    <td class="client-name-col" title="{{::row.waypoint.NAME}}">{{::row.waypoint.NAME}}</td>
                    <td class="address-col" title="{{::row.waypoint.ADDRESS}}">{{::row.waypoint.ADDRESS}}</td>
                    <td class="time-window-col">{{row.AVAILABILITY_WINDOWS}}</td>
                    <td class="plan-arrival-time-col" ng-class="row.class2">{{row.arrival_time_ts * 1000 | date:'HH:mm'}}</td>
                    <td class="promised-window-col">
                        {{row.promised_window_changed.start * 1000 | date:'HH:mm'}} -
                        {{row.promised_window_changed.finish * 1000 | date:'HH:mm'}}
                    </td>
                    <td class="time-left-window-col">{{ (row.status==4 || row.status==5 ||row.status==7 ||row.status==6) ? (parseInt((row.promised_window_changed.finish - nowTime)/3600) +'ч.' + parseInt((parseInt(((row.promised_window_changed.finish - nowTime) -(parseInt((row.promised_window_changed.finish - nowTime)/3600))*3600 )))/60)) + 'м.' : ""  }}</td>
                    <td class="prediction-arrival-time-col">
                        <span ng-if="(row.arrival_prediction >0) && (row.status>3 && row.status<8) && (row.transport.gid!=undefined) && (row.transport.real_track!=undefined) && (nowTime - row.transport.real_track[row.transport.real_track.length-1].t2<60*60)">
                            {{(nowTime + row.arrival_left_prediction)*1000 | date: 'HH:mm' }}
                        </span>
                    </td>
                    <td class="overdue-col">
                        <span ng-if="(row.arrival_prediction > 0) && (row.status ==7 || row.status ==4 || row.status==5) && (row.transport.gid!=undefined) && (row.transport.real_track!=undefined) && (nowTime - row.transport.real_track[row.transport.real_track.length-1].t2<60*60)  ">
                             {{row.arrival_left_prediction*1000 | date: 'HH:mm' : 'UTC'  }}<!-- |date: 'HH:mm' : 'UTC'-->
                        </span>
                    </td>
                    <td class="real-arrival-time-col">
                        <span ng-if="row.real_arrival_time > 0 && (row.status <=3 || row.status==6)">
                            {{row.real_arrival_time*1000 |  date: 'HH:mm' }}
                        </span>
                    </td>
                    <td class="overdue-col">
                        <span ng-if="row.overdue_time > 0">
                            {{row.overdue_time*1000 |  date: 'HH:mm' : 'UTC' }}
                        </span>
                    </td>
                    <td class="stop-col">{{row.haveStop ? 'Есть' : ((row.status<3 || row.status==6 || row.status==8) ? 'Нет' : '')}}</td>
                    <td id="{{'push-td-' + row.row_id}}" class="mobile-push-col"
                        title="{{ row.mobile_push ? ('время: ' + row.mobile_push.time + '\n' +
                                'время gps: ' + row.mobile_push.gps_time + '\n' +
                                'расстояние до точки: ' + row.mobile_push.distance + ' м') : ''}}">
                        {{row.mobile_push ? ((getPushStatus(row)).substr(-8)).substring(0,5) : ((row.status<3 || row.status==6 || row.status==8) ? 'Нет' : '')}}
                    </td>
                    <td class="gps-conf-col" title="{{::row.waypoint.CONFIRMBYGPS}}">{{row.waypoint.CONFIRMBYGPS =="true" ? "Есть":"Нет"}}</td>
                    <td class="promised-window-changed-col"> {{row.change_time ? row.change_time : ''}}</td>
                    <td class = "window-type-col" id="{{'window-td-' + row.row_id}}">{{row.windowType}}</td>

                    <td class="car-number-col">{{::row.transport.REGISTRATION_NUMBER}}</td>
                    <td class="driver-phone-col">{{::row.driver.PHONE}}</td>
                    <td class="branch-col">{{::row.branchName}}</td>
                    <td class="problem-index-col">
                        <span ng-if="row.problem_index > 0">
                        {{row.problem_index}}
                        </span>
                    </td>
                    <td clas="comment-col" title="{{::row.waypoint.COMMENT}}">{{::row.waypoint.COMMENT}}</td>



                </tr>
                </tbody>
            </table>

            <div id="context-menu">
                <ul class="dropdown-menu" role="menu">
                    <li><a tabindex="-1" data-menu-option="sort">Вкл/Выкл фильтр по маршруту</a></li>
                    <li><a tabindex="-1" data-menu-option="edit">Редактировать маршрут</a></li>
                </ul>
            </div>
        </div>
        </div>
    </div>
        </div>
</template>

<!-- прозрачное окно для отображения карты -->
<template type="text/html" id="transparent-map-window">
    <div class="section" ng-controller="MapController" id="transparent-map-holder">
        transparent-map-window
    </div>
</template>




<!-- панель настроек -->
<template type="text/html" id="setting-window" ng-show="false" display="none"  >
    <div class="section setting-panel" ng-show="false" ng-controller="SettingController">
        <!--<div class="block">-->
            <!--<div class="title">Загрузка конкретного дня</div>-->
            <!--<div class="setting-row">-->
                <!--<span class="param-title">Отображаемый день</span>-->
                <!--<input type="date"-->
                       <!--ng-model="showDate"-->
                       <!--id="show-date"/>-->
                <!--<button class="btn btn-info btn-sm" ng-click="loadOldDay()">Загрузить</button>-->
            <!--</div>-->
        <!--</div>-->

        <div class="block" ng-show="demoMd" id="demo-setting">
            <div class="title">Настройки демо-режима</div>
            <div class="setting-row">
                <span class="param-title">Время в демо-режиме</span>
                <input type="range" min="0" max="168" ng-model="params.demoTime"/>
                {{(startDemoTime + 300 * params.demoTime) * 1000 | date:'HH:mm'}}
            </div>
        </div>

        <div class="block">
            <div class="title">Настройка сортировки выбора маршрута</div>
            <div class="setting-row">
                <p><input type="radio" ng-model="params.routeListOrderBy"  value="nameDriver" > По фамилии</p>
                <p><input type="radio" ng-model="params.routeListOrderBy"  value="nameCar" > По машине</p>
            </div>
        </div>

        <div class="block">
            <div class="title">Настройка типа рабочего окна</div>
            <div class="setting-row">
                <span class="param-title">Тип рабочего окна</span>
                <select ng-model="params.workingWindowType" class="group-select"
                        ng-options='option.value as option.name for option in workingWindowTypes'>
                </select>
            </div>
        </div>

        <div class="block">
            <div class="title">Настройка фильтра невыполненных доставок на краю рабочего окна</div>
            <div class="setting-row">
                <span class="param-title">Размер фильтра (минуты)</span>
                <input type="range" min="1" max="24" ng-model="params.endWindowSize"/>
                {{params.endWindowSize * 5}}
            </div>
        </div>

        <div class="block">
            <div class="title">Настройка автопривязки привязки стопов и моб.нажатий</div>
            <div class="setting-row">
                <span class="param-title">Радиус автопривязки стопов</span>
                <input type="range" min="10" max="500" ng-model="params.stopRadius"/>
                {{params.stopRadius}}
            </div>
            <div class="setting-row">
                <span class="param-title">Радиус автопривязки моб.нажатий</span>
                <input type="range" min="10" max="500" ng-model="params.mobileRadius"/>
                {{params.mobileRadius}}
            </div>
            <div class="setting-row">
                <span class="param-title">Временное смещение стопа (минуты)</span>
                <input type="range" min="10" max="480" ng-model="params.timeThreshold"/>
                {{params.timeThreshold}}
            </div>
        </div>

        <div class="block">
            <div class="title">Настройки коэффициентов индекса проблемности</div>
            <div class="setting-row">
                <span class="param-title">Влияние прогнозного опоздания</span>
                <input type="range" min="0" max="100" ng-model="params.predictMinutes"/>
                {{params.predictMinutes / 10}}
            </div>
            <div class="setting-row">
                <span class="param-title">Влияние фактического опоздания</span>
                <input type="range" min="0" max="100" ng-model="params.factMinutes"/>
                {{params.factMinutes / 10}}
            </div>
            <div class="setting-row">
                <span class="param-title">Влияние объема</span>
                <input type="range" min="0" max="100" ng-model="params.volume"/>
                {{params.volume / 10}}
            </div>
            <div class="setting-row">
                <span class="param-title">Влияние веса</span>
                <input type="range" min="0" max="100" ng-model="params.weight"/>
                {{params.weight / 10}}
            </div>
            <div class="setting-row">
                <span class="param-title">Влияние стоимости</span>
                <input type="range" min="0" max="100" ng-model="params.value"/>
                {{params.value / 10}}
            </div>
            <div class="setting-row">
                <span class="param-title">Влияние переносов</span>
                <input type="range" min="0" max="100" ng-model="params.changeTime"/>
                {{params.changeTime / 10}}
            </div>
        </div>
        <div class="button-row">
            <button class="btn btn-info btn-sm" ng-click="saveAllParams()">Сохранить</button>
        </div>


    </div>
</template>

<!-- панель редактирования маршрута Пока закомментирована -->


<template   type="text/html" id="edit-route">
    <div id="edit-panel" ng-controller="EditRouteController">
        <div ng-show="route == undefined" id="edit-panel-empty">
            Маршрут для редактирования не выбран
        </div>

        <!-- меню -->
        <!--<div id="edit-panel-menu" ng-show="route !== undefined">-->
            <!--<select id="recalc-mode-select" ng-model="recalc_mode" class="group-select"-->
                    <!--ng-options='option.value as option.name for option in recalc_modes'>-->
            <!--</select>-->

            <!--<button class="btn btn-info btn-sm"-->
                    <!--id="to-recalculate-btn"-->
                    <!--ng-click="recalculateRoute()"-->
                    <!--ng-disabled="disableRecalculate">-->
                <!--пересчитать-->
            <!--</button>-->

            <!--<button class="btn btn-info btn-sm"-->
                    <!--ng-click="saveRoutes()"-->
                    <!--ng-disabled="disableSaveRoutes">сохранить</button>-->

            <!--<button class="btn btn-info btn-sm" ng-click="cancelEdit()">отменить</button>-->
        <!--</div>-->

        <div ng-show="parent_route.have_attention" style="color: orangered" ng-model="accept" ng-click="accept=true">
            !!!!!!! В этом маршруте сть точки со статусом внимание !!!!!!!
        </div>

        <div ng-show="route !== undefined">
             Сделано попыток перерасчета  по маршруту {{iteration || 0}} {{route.recalcIter}}
        </div>
        <div ng-show="route !== undefined " >
            <button class="btn btn-info btn-sm"
            ng-click="recalculateRoute()">Рассчитать</button>
        </div>
        <div>
            Предлагаемое количество новых маршрутов = {{newRoutes}}
        </div>

        <div class="point-table-wrap" style="overflow: auto;height: calc(100% - 92px);" >
            <div id="recalc-table" class="table-holder" >


                <table class="table table-striped point-table" id="recalc-table-tbl" >
                    <!-- ng-show="newRoutes == 1"-->
                    <tr class="titles-tr">
                        <th>Номер</th>
                        <th>Статус</th>
                        <th>ЗОК</th>
                        <th>КОК</th>
                        <th>Новое время</th>
                        <th>Переносы</th>
                        <th>Окно</th>
                        <th>Отмена</th>

                    </tr>


                    <tr ng-repeat="item in display" ng-click="loadSerchResult (item.uniqueID)"  >


                        <td>{{item.exNumber}}</td>
                        <td>{{item.status}}</td>
                        <td>{{item.startZOK* 1000 | date:'HH:mm'}}-{{item.endZOK* 1000 | date:'HH:mm'}}</td>
                        <td>{{item.startKOK* 1000 | date:'HH:mm'}}-{{item.endKOK* 1000 | date:'HH:mm'}}</td>
                        <td>{{item.newArrival* 1000 | date:'HH:mm'}}</td>
                        <td>{{item.changes}}</td>
                        <td>
                            <button ng-click="showWindow(item)">ред.окно</button>
                            <div ng-show="item.editWindow">

                                <input type="time" class="promised-text-card" id="promised-start-edit"

                                       ng-model="newStart"> -
                                <input type="time" class="promised-text-card" id="promised-finish-edit"

                                       ng-model="newFinish">
                                <button ng-click="handRecalc(item, newStart, newFinish, route)">проверить</button>
                            </div>
                        </td>
                        <td><button ng-click ="cancelJob(item, route)">отменить</button></td>


                    </tr>

                </table>
        <button ng-click="confirmEditing()">Утвердить</button>
        <button>Ручное редактирование</button>


        <!--<div ng-model="accept" ng-show="route !== undefined && (accept || !parent_route.have_attention)">-->


            <!--<div class="block-title" style="color: maroon; font-weight: 600">Изменение обещанных окон в рамках заказанных</div>-->
                <!--<div>-->
                    <!--<div> Точка &nbsp&nbsp Заказанное окно &nbsp&nbsp Обещанное окно  &nbsp&nbsp План. прибытие&nbsp&nbsp Новое окно &nbsp&nbsp&nbsp Переносов</div>-->
                    <!--<div> Иванов &nbsp&nbsp&nbsp10.00 - 14.00  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp11.00 - 12.00   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 13.40   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 13.00 -14.00 &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 1</div>-->

                    <!--<button class="btn btn-info btn-sm"-->
                            <!--ng-click="recalculateRoute()">принять</button>-->
                <!--</div>-->

        <!--</div>-->
        <!--<br>-->
        <!--<div ng-model="accept" ng-show="route !== undefined && (accept || !parent_route.have_attention)">-->
            <!--<div class="block-title" style="color: maroon; font-weight: 600">Перенос заказа на другое время по согласованию с получателем</div>-->

                <!--<div> Точка &nbsp&nbsp&nbsp&nbsp&nbsp Заказанное окно &nbsp&nbsp&nbsp&nbsp&nbsp Новое окно &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp  План. прибытие&nbsp&nbsp  Переносов</div>-->
                <!--<div> Иванов &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp10.00 - 14.00  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp11.00 - 12.00  &nbsp&nbsp &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 11.20   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 1</div>-->
                    <!--<div> Вариант 1 &nbsp&nbsp&nbsp&nbsp10.00 - 14.00  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp14.00 - 15.00  &nbsp&nbsp &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 14.20    &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 1</div>-->
                    <!--<button class="btn btn-info btn-sm"-->
                            <!--ng-click="saveRoutes()"-->
                            <!--ng-disabled="disableSaveRoutes">принять</button>-->
                <!--<div> Вариант 2 &nbsp&nbsp&nbsp&nbsp10.00 - 14.00  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp19.00 - 20.00  &nbsp&nbsp &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 19.20    &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 1</div>-->
                <!--<button class="btn btn-info btn-sm"-->
                        <!--ng-click="saveRoutes()"-->
                        <!--ng-disabled="disableSaveRoutes">принять</button>-->
        <!--</div>-->


        <!--<br>-->
        <!--<div ng-model="accept" ng-show="route !== undefined && (accept || !parent_route.have_attention)">-->
            <!--<div class="block-title" style="color: maroon; font-weight: 600">Отмена точки и перенос на другой день</div>-->
            <!--<div class="col-sm-3">-->
                <!--<input type="date"-->
                       <!--class="width100 heightElement"-->
                       <!--ng-model="showDate"-->
                       <!--id="show-next-date"/>-->
            <!--</div>-->

                <!--<input type="time" class="promised-text-card" id="promised-next-start-card"-->
                       <!--ng-change="changePromisedCard()"-->
                       <!--ng-model="promisedStartCard"-->
                       <!--enter-event="changePromisedWindow(point)"> - -->
                <!--<input type="time" class="promised-text-card" id="promised-next-finish-card"-->
                       <!--ng-change="changePromisedCard()"-->
                       <!--ng-model="promisedFinishCard"-->

                       <!--enter-event="changePromisedWindow(point)">-->
            <!--<button class="btn btn-info btn-sm"-->
                    <!--ng-click="saveRoutes()"-->
                    <!--ng-disabled="disableSaveRoutes">принять</button>-->
        <!--</div>-->

        <!--<br>-->
        <!--<div ng-model="accept" ng-show="route !== undefined && (accept || !parent_route.have_attention)">-->
            <!--<div class="block-title" style="color: maroon; font-weight: 600">Изменение порядка следования</div>-->
            <!--<div>-->
                <!--<div> Точка &nbsp&nbsp Заказанное окно &nbsp&nbsp Обещанное окно  &nbsp&nbsp План. прибытие&nbsp&nbsp Новое окно &nbsp&nbsp&nbsp Переносов</div>-->
                <!--<div> Иванов &nbsp&nbsp&nbsp10.00 - 14.00  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp11.00 - 12.00   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 13.40   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 13.00 -14.00 &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 1</div>-->
                <!--<div> Петров &nbsp&nbsp&nbsp11.00 - 16.00  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp11.00 - 12.00   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 15.40   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 15.00 -16.00 &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 1</div>-->

                <!--<button class="btn btn-info btn-sm"-->
                        <!--ng-click="saveRoutes()"-->
                        <!--ng-disabled="disableSaveRoutes">принять</button>-->
                <!--<button class="btn btn-info btn-sm"-->
                        <!--ng-click="saveRoutes()"-->
                        <!--ng-disabled="disableSaveRoutes">редактировать</button>-->
            <!--</div>-->

            <!--<div>-->
                <!--<div> Точка &nbsp&nbsp Заказанное окно &nbsp&nbsp Обещанное окно  &nbsp&nbsp План. прибытие&nbsp&nbsp Новое окно &nbsp&nbsp&nbsp Переносов</div>-->
                <!--<div> Иванов &nbsp&nbsp&nbsp&nbsp&nbsp10.00 - 14.00  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp11.00 - 12.00   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 13.40   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 13.00 -14.00 &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 0</div>-->
                <!--<div style="color: darkred"> Сидоров &nbsp&nbsp&nbsp12.00 - 16.00  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp12.00 - 13.00   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 16.20   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 13.00 -14.00 &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 0</div>-->
                <!--<div> Пупкинд &nbsp&nbsp&nbsp16.00 - 20.00  &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp16.00 - 17.00   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 19.40   &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 19.00 -20.00 &nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp 0</div>-->


                <!--<button class="btn btn-info btn-sm"-->
                        <!--ng-click="saveRoutes()"-->
                        <!--ng-disabled="disableSaveRoutes">принять</button>-->
                <!--<button class="btn btn-info btn-sm"-->
                        <!--ng-click="saveRoutes()"-->
                        <!--ng-disabled="disableSaveRoutes">редактировать</button>-->
            <!--</div>-->


        <!--</div>-->



        <!-- оригинальный маршрут до изменений -->
        <!--<div ng-show="route !== undefined">-->
            <!--<div id="original-route">-->
                <!--<div class="block-title">Плановый маршрут</div>-->
                <!--<div>-->
                    <!--<div ng-repeat="box in originalBoxes" class="box" style="width: {{box.width}}px;"-->
                         <!--ng-class="{'task-box': box.type == BOX_TYPE.TASK,-->
                                    <!--'travel-box': box.type == BOX_TYPE.TRAVEL,-->
                                    <!--'downtime-box': box.type == BOX_TYPE.DOWNTIME,-->
                                    <!--'too-big-box': box.tooBig,-->
                                    <!--'finished-box': box.status == STATUS.FINISHED-->
                                                    <!--|| box.status == STATUS.FINISHED_TOO_EARLY-->
                                                    <!--|| box.status == STATUS.FINISHED_LATE,-->
                                    <!--'warehouse-box': box.warehouse}"-->
                         <!--title="{{tooltip(box)}}">-->
                        <!--{{box.warehouse ? 'СКЛАД (' + box.number + ')' : box.number}}-->
                        <!--<span ng-show="box.tooBig">-->
                            <!--<span class="glyphicon glyphicon-menu-right"></span>-->
                            <!--<span class="glyphicon glyphicon-menu-right"></span>-->
                            <!--<span class="glyphicon glyphicon-menu-right"></span>-->
                        <!--</span>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->

            <!--&lt;!&ndash; изменяемая копия маршрута &ndash;&gt;-->
            <!--<div id="changed-route">-->
                <!--<div class="block-title">Измененный маршрут</div>-->
                <!--<div id="boxes">-->
                    <!--<div ng-repeat="box in changebleBoxes" class="box droppable-box" style="width: {{box.width}}px;"-->
                         <!--ng-class="{'task-box': box.type == BOX_TYPE.TASK,-->
                                    <!--'draggable-box': box.type == BOX_TYPE.TASK && !box.warehouse,-->
                                    <!--'travel-box': box.type == BOX_TYPE.TRAVEL,-->
                                    <!--'downtime-box': box.type == BOX_TYPE.DOWNTIME,-->
                                    <!--'late-box': box.late,-->
                                    <!--'too-big-box': box.tooBig,-->
                                    <!--'warehouse-box': box.warehouse}"-->
                         <!--title="{{tooltip(box)}}"-->
                         <!--data-index="{{box.index}}"-->
                         <!--id="box-{{box.type}}-{{box.index}}"-->
                         <!--ng-dblclick="boxDblClick(box.waypointNumber)">-->
                        <!--{{box.warehouse ? 'СКЛАД (' + box.number + ')' : box.number}}-->
                        <!--<span ng-show="box.tooBig">-->
                            <!--<span class="glyphicon glyphicon-menu-right"></span>-->
                            <!--<span class="glyphicon glyphicon-menu-right"></span>-->
                            <!--<span class="glyphicon glyphicon-menu-right"></span>-->
                        <!--</span>-->
                    <!--</div>-->
                    <!--&lt;!&ndash;<div class="box end-box droppable-box" data-index="55555">END</div>&ndash;&gt;-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->
        <div id="change-driver" ng-show="route !== undefined && false" >
            <div class="block-title">Замена (Водителя/Машины) на маршруте</div>
            <div id="change-driver-menu" > Произвести замену: <br>
                {{route.driver.NAME}} на машине {{route.transport.NAME}} с номером {{route.transport.REGISTRATION_NUMBER}}<br>

                <div id="transport-select"> Выберите транспорт:
                    <select ng-model="selectedTransport"
                            ng-options=" option.ID as option.NAME for option in allTransports | orderBy: 'NAME'" >

                    </select>
                    <div id="driver-select"> Выберите  водителя:&nbsp;
                        <select ng-model="selectedDriver"
                                ng-options="option.ID as option.NAME for option in allDrivers | orderBy: 'NAME'" >

                        </select>

                        <div id="start-select"> Старотовая точка:&nbsp;&nbsp;&nbsp;&nbsp;
                            <select ng-model="selectedStart"
                                    ng-options="option.NUMBER as option.NUMBER for option in route.points | orderBy: 'parseInt(NUMBER)'" >

                            </select>
                            <div>
                                <button class="btn btn-info btn-sm" ng-disabled="!selectedTransport || !selectedDriver || !selectedStart" ng-click="changeDriver()" >Заменить</button>
                            </div>

                </div>



            </div>
        </div>

        </div>
        </div>

            </div>
            </div>
        </div>
</template>

<!-- панель закрытия дня -->
<template type="text/html" id="close-day" >
    <!-- полупрозрачное окно для затемнения таблицы -->
    <!--<div class="close-day-wrapper" >-->
        <!--<div class="title"  ng-show="clickOff" id="transparent-closeday-window" ></div>-->

        <!--<div id="close-day-panel" ng-controller = "CloseDayController" ng-show="false">-->
            <!--<button ng-click = "showCheckBoxToClose()">Готовые к закрытию</button>-->
            <!--<button ng-click = "closeDayClick()" ng-disabled="disabledBtnCloseDay">Закрыть выбранные</button>-->

            <!--&lt;!&ndash;Имя компании: {{companyName}},&ndash;&gt;-->
            <!--&lt;!&ndash;Время: {{(serverTime*1000) | date:"HH:MM"}}.&ndash;&gt;-->

            <!--<div>-->
                  <!--Ответственный: {{user}},-->
                  <!--Дата :{{(serverTime*1000) | date:"dd.MMMM.y"}}-->

            <!--</div>-->
            <!--<div>-->
                <!--<table>-->
                    <!--<tr>-->
                        <!--<th>&lt;!&ndash;input id="main-checkbox" ng-click = "showCheckBoxToClose()" type="checkbox" ng-checked = "setCheckAll" ng-model = "getCheckAll"&ndash;&gt;-->
                            <!--<button ng-click="orderCloseDay('getCheck')">Закончен</button></th>-->
                        <!--<th><button ng-click="order('filterId'); orderCloseDay('getCheck')" >ID</button></th>-->
                        <!--<th><button ng-click="order('driver.NAME'); orderCloseDay('getCheck')">Водитель</button></th>-->
                        <!--<th><button ng-click="order('transport.NAME'); orderCloseDay('getCheck')">Машина</button></th>-->
                        <!--&lt;!&ndash;th>Старт</th&ndash;&gt;-->
                        <!--<th class="center"><button ng-click="order('START_TIME');">СТАРТ</button></th>-->
                        <!--<th><button ng-click="order('END_TIME');">Финиш</button></th>-->
                        <!--<th><button ng-click="order('(real_track[real_track.length-1].t2)');">GPS сигнал</button></th>-->

                    <!--</tr>-->
                    <!--<tr   ng-class="item.selected ? 'driver-select-bg' : ''" class = "close-table-row" ng-repeat="item in data.routes " ng-click = "closeTableRowClick(item)">-->
                        <!--&lt;!&ndash;/TODO | filter: { getCheck: false } Фильтр оставшийся с времен расчета на клиенте из строчки выше.&ndash;&gt;-->

                        <!--<td><input id = "close-table-checkbox-{{item.filterId}}"-->
                                   <!--type="checkbox"-->
                                   <!--ng-model="item.ready_to_close"-->
                                   <!--ng-disabled="true">-->
                        <!--</td>-->
                        <!--<td>{{::item.filterId+1}}</td>-->
                        <!--<td id = "close-table-driver-{{item.filterId}}">{{item.driver.NAME}}</td>-->
                        <!--<td >{{::item.transport.NAME}}</td>-->


                        <!--<td>{{::item.START_TIME.split(' ')[0].substring(0,5)}} {{item.START_TIME.split(' ')[1]}} -&nbsp;</td>-->
                        <!--<td> {{:: item.END_TIME.split(' ')[1]}}</td>-->
                        <!--<td> {{ (item.real_track == undefined || item.real_track.length == 0) ? "No signal" : ((item.real_track[item.real_track.length-1].t2)*1000) | date :'dd.MM HH:mm' }}</td>-->
                    <!--</tr>-->


                    <!--<tr>-->
                        <!--<td colspan="3" >-->
                            <!--<select ng-model="selectDeyOldRoutes"-->
                                    <!--ng-show="showSelectDayOldRoutes"-->
                                    <!--ng-change="chengeSelectDayOldRoutes()"-->
                                    <!--ng-options="day as day  for day in deysOldRoutes"-->
                                    <!--class="seleOldRoute">-->
                                <!--<option value="" selected="selected">У вас есть незакрытые дни</option>-->
                            <!--</select>-->
                        <!--</td>-->
                        <!--<td colspan="2" >-->
                            <!--<button ng-click="getCurrentday()" ng-show="showGetCurrentday">Вернуться в текущий день</button>-->
                        <!--</td>-->
                    <!--</tr>-->

                    <!--<tr   ng-class="[item.closeRoute ? 'closeroute' : '', item.selected ? 'driver-select-bg' : '']   "  class = "close-table-row" ng-repeat="item in data.routes | filter: { getCheck: true } " ng-click = "closeTableRowClick(item)">-->
                        <!--<td><input id = "close-table-checkbox-{{::item.filterId}}"-->
                                   <!--type="checkbox"-->
                                   <!--ng-model="item.getCheck"-->
                                   <!--ng-disabled="true">-->
                        <!--</td>-->
                        <!--<td>{{::item.filterId}}</td>-->
                        <!--<td id = "close-table-driver-{{::item.filterId}}">{{::item.driver.NAME}}</td>-->
                        <!--<td class="center">{{item.transport.NAME}}</td>-->


                        <!--<td>{{::item.START_TIME.split(' ')[0].substring(0,5)}} {{::item.START_TIME.split(' ')[1]}} - </td>-->
                        <!--<td> {{::item.END_TIME.split(' ')[1]}}</td>-->
                        <!--<td> {{:: (item.real_track == undefined || item.real_track == 0) ? "No signal": ((item.real_track[item.real_track.length-1].t2)*1000) | date :'dd.MM HH:mm'}}</td>-->
                    <!--</tr>-->


                <!--</table>-->
            <!--</div>-->


            <!--&lt;!&ndash; Визуальная часть закрытия дня &ndash;&gt;-->
        <!--</div>-->
    <!--</div>-->


    <div ng-controller = "CloseDayController">
        <div class="block-title">
            &nbsp&nbspПоиск по всем маршрутам
        </div>

        <div class="col-sm-3">
            <input  id="search-input-on-node" class="heightElement" type="text" size="50" ng-model="forNodeSerch" enter-event="startSerchOnNode()"/>
            <!--<button  class="btn btn-info btn-sm filter-btn searchButton" ng-click="startSerchOnNode()">-->
                <!--<span class="glyphicon glyphicon-search" aria-hidden="false"></span>-->
            <!--</button>-->
        </div> <br> <br>

        <div>
            <button ng-show="data != undefined && ((data.settings.user == 'ids.kalko') || (data.settings.user == 'ids.dsp') )" ng-click="statuses()"> STATUS</button>
        </div>

        <div class="block-title">
            &nbsp&nbspРезультат поиска:
        </div>

        <div class="point-table-wrap" style="overflow: auto;height: calc(100% - 92px);" >
            <div id="serch-table" class="table-holder" >


                <table class="table table-striped point-table" id="serch-table-tbl" >
                    <tr class="titles-tr">
                        <th>Водитель</th>
                        <th>Название</th>
                        <th> Адресс</th>
                        <th> Комментарий </th>
                    </tr>

                    <tr ng-repeat="item in serchDisplay" ng-click="loadSerchResult (item.uniqueID)"  >


                        <td>{{item.driverName}}</td>
                        <td>{{item.name}}</td>
                        <td>{{item.adress}}</td>
                        <td>{{item.comment}}</td>
                    </tr>

                    </table>
                </div>
            </div>
        </div>




</template>


<!-- панель закрытия дня -->
<template type="text/html" id="statistic-tmp">
    <div ng-controller = "StatisticController" >
        <table class="statistic-table">
            <thead>
            <tr>
                <th class="scheduled-status">Ожидается поставка</th>
                <th class="delivered-status">Доставлено</th>
                <th class="attention-status">Внимание</th>
                <th class="delay-status">Опаздывает</th>
                <th class="time-out-status">Время вышло</th>
                <th class="canceled-status">Отменено</th>
            </tr>
            </thead>
            <tr>
                <td class="scheduled-status">{{statistic.scheduled}}</td>
                <td class="delivered-status">{{statistic.delivered}}</td>
                <td class="attention-status">{{statistic.attention}}</td>
                <td class="delay-status">{{statistic.delay}}</td>
                <td class="time-out-status">{{statistic.timeOut}}</td>
                <td class="canceled-status">{{statistic.canceled}}</td>
            </tr>
        </table>
    </div>
</template>

<div id="problem-route-list" ng-controller="ProblemRouteController" style="position: absolute; bottom: 60%; left: 1%"
     ng-model="data.routes"
     ng-show="!clickOff && data.routesOfDate == undefined">

    <div ng-repeat="route in data.routes" ng-click="showProblem(route)">
        <div>
            <button style="background: red">{{route.max_problem == 0 ? "нет проблем" : route.kind_of_problem }} {{route.max_problem}}</button>
        </div>
        <div style="background: transparent"><br></div>
    </div>
</div>

<!-- див для отображения окна точки -->
<div id="point-view" ng-controller="PointViewController">
    <div class="row point-view-header">
        <div class="col-md-3"></div>
        <div class="col-md-6">
            <div class="card-title">
                Карточка задания
                <button class="btn btn-primary btn-sm"
                        ng-show="data.companyName == '292942'"
                        ng-click="open1CWindow()">Открыть в 1С
                </button>
            </div>
        </div>
        <div class="col-md-3">
            <button  class="point-view-close-btn btn-sm btn btn-danger" ng-click="cancel()">Закрыть
            </button>
        </div>
    </div>
    <table id="point-view-table" class="table table-striped">
        <tbody>
        <tr>
            <td class="title">Название:</td>
            <td class="row-data">{{point.waypoint.NAME}}</td>
        </tr>


        <tr>
            <td class="title">Адрес:</td>
            <td class="row-data">{{point.waypoint.ADDRESS}}</td>
        </tr>
        <tr>
            <td class="title">План. прибытие:</td>
            <td class="row-data">{{point.arrival_time_ts * 1000 | date:'HH:mm'}}
                <div ng-show="false" >
                <button class="btn btn-primary btn-xs btn-success" >Подтвердить</button>
                <input type="time" class="promised-text-card" id="promised-start-card"
                       ng-change="changePromisedCard()"
                       ng-model="promisedStartCard"
                       enter-event="changePromisedWindow(point)"> -
                <input type="time" class="promised-text-card" id="promised-finish-card"
                       ng-change="changePromisedCard()"
                       ng-model="promisedFinishCard"

                       enter-event="changePromisedWindow(point)">
                <button id="change-window-task-btn" class="btn btn-primary btn-xs"  ng-click="changePromisedWindow({point:point, parent:'editRoute'})">Рассчитать</button>
                </div>
            </td>



        </tr>
        <tr>
            <td class="title">План. номер:</td>
            <td class="row-data">{{point.NUMBER}}</td>
        </tr>


        <tr>
            <td class="title">Машина:</td>
            <td class="row-data">{{point.transport.NAME}}</td>
        </tr>
        <tr>
            <td class="title">Водитель:</td>
            <td class="row-data">{{point.driver.NAME}}</td>
        </tr>
        <tr>
            <td class="title">Окно доступности</td>
            <td class="row-data">{{point.waypoint.AVAILABILITY_WINDOWS}}</td>
        </tr>

        <tr>
            <td class="title">Заказанное окно:</td>
            <td class="row-data">{{point.AVAILABILITY_WINDOWS}}</td>
        </tr>
        <tr>
            <td class="title">Обещанное окно:</td>
            <td class="row-data">
                {{point.promised_window.start * 1000 | date:'HH:mm'}} -
                {{point.promised_window.finish * 1000 | date:'HH:mm'}}
            </td>
        </tr>
        <tr ng-show="false">
            <td class="title">Контролируемое окно:</td>
            <td class="row-data">
                <input type="time" class="promised-text-card" id="altpromised-start-card"
                       ng-change="changePromisedCard()"
                       ng-model="promisedStartCard"
                       enter-event="changePromisedWindow(point)"> -
                <input type="time" class="promised-text-card" id="altpromised-finish-card"
                       ng-change="changePromisedCard()"
                       ng-model="promisedFinishCard"

                       enter-event="changePromisedWindow(point)">
                <button id="altchange-window-task-btn" class="btn btn-primary btn-xs" ng-disabled="disableConfirmBtn" ng-click="changePromisedWindow(point)">Изменить</button>

            </td>
        </tr>
        <tr>
            <td class="title">Тел. водителя:</td>
            <td class="row-data">{{point.driver.PHONE}}</td>
        </tr>
        <tr>
            <td class="title">Комментарий:</td>
            <td class="row-data">{{point.waypoint.COMMENT}}</td>
        </tr>
        <tr>
            <td class="title">Статус:</td>
            <td class="row-data">
                {{point.textStatus}}
        </tr>
        <tr>
            <td>Подтверждение</td>
            <td>
                <div ng-show="showHideReasonButtons">
                        <button id="confirm-status-task-btn"
                                ng-disabled="selectReasonList"
                                class="btn btn-primary btn-xs btn-success" ng-click="confirmStatus()">Подтвердить
                        </button>
                </div>
                <div ng-show="!showHideReasonButtons">
                    <button class="btn btn-primary btn-xs btn-warning" ng-click="returnStatus()">Отменить изменение</button>
                </div>
            </td>
        </tr>
        <tr>
            <td>Отмена</td>
            <td>
                <div class="row" ng-show="showHideReasonButtons">
                    <div class="col-md-5">
                        <select ng-model="selectReasonList" class="reason-list"
                                ng-options="item.ID as item.DESCRIPTION  for item in reasons">
                            <option value="" selected>--Причина отказа--</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button id="cancel-status-task-btn"
                                ng-disabled="!selectReasonList"
                                class="btn btn-primary btn-xs btn-danger" ng-click="cancelTask()">Отменить
                        </button>
                    </div>
                </div>
            </td>
        </tr>

        <!--<tr>-->
            <!--<td class="title">Окно:</td>-->
            <!--<td class="row-data">{{point.AVAILABILITY_WINDOWS}}</td>-->
        <!--</tr>-->
        <tr>
            <td class="title">Моб. нажатие:</td>
            <td class="row-data">{{point.mobile_push.time}}
                <button id="cancel-push-btn" ng-show="point.mobile_push.time != undefined" class="btn btn-primary btn-xs btn-danger" ng-click="cancelPush()">Отменить</button>
            </td>

        </tr>
        <tr>
            <td class="title">Стоимость:</td>
            <td class="row-data">{{point.VALUE}}</td>
        </tr>
        <tr>
            <td class="title">Объем:</td>
            <td class="row-data">{{point.VOLUME}}</td>
        </tr>
        <tr>
            <td class="title">Вес:</td>
            <td class="row-data">{{point.WEIGHT}}</td>
        </tr>
        </tbody>
    </table>

    <!-- <div id="point-view-setting" ng-show="locked(point)">

        <button id="lock-route-btn" class="btn btn-primary btn-sm down-btn"
                ng-class="point.lockedRoute ? 'btn-danger' : 'btn-primary'" ng-click="toggleRouteBlock()">
            <i class="fa fa-md" ng-class="point.lockedRoute ? 'fa-lock' : 'fa-unlock'"></i>
            &nbsp;Машрут
        </button>
        <button id="edit-task-btn" class="btn btn-sm down-btn"
                ng-class="point.locked ? 'btn-danger' : 'btn-primary'" ng-click="toggleTaskBlock()">
            <i class="fa fa-md" ng-class="point.locked ? 'fa-lock' : 'fa-unlock'"></i>
            &nbsp;Задание
        </button>

        <button id="cancel-task-btn" class="btn btn-danger btn-sm down-btn" ng-click="cancelTask()">Отменить задание
        </button>

    </div>
<!--Окошко для редактирования точек и времени-->
</div>



<div id="point-editing-popup" ng-controller="PointPopupEditController" style="position: absolute; visibility: hidden">

        <div class="card-title">
            <div id="container">
                <div class = "row">
                    <div class = "col-md-3">
                    </div>
                    <div class = "col-md-6">
                        Карточка остановки
                    </div>
                    <div class = "col-md-3">
                        <button id="btn-close" class="btn btn-danger" ng-click="cancel()">Закрыть
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <table id="stop-info-table" >
                <tbody>
                <tr class="stop-table-title">
                    <td>Номер стопа</td>
                    <td>Время начала</td>
                    <td>Время окончания</td>
                    <td>Продолжительность</td>
                </tr>
                <tr>
                    <td class="row-data">{{stopIndx}}</td>
                    <td class="row-data">{{start*1000 | date: "HH:mm"}}</td>
                    <td class="row-data">{{fin*1000 | date: "HH:mm"}}</td>
                    <td class="row-data">{{(delta/60)}} мин</td>
                </tr>
                </tbody>
            </table>
        </div>
    <div ng-show="stopWithPoints" >
        <table id="stop-point-view-table">
            <tbody>
            <tr class="stop-table-title">
                <td class="title">Точка доставки:</td>
                <td class="title">Плановое время обслуживания</td>
                <td class="title">Реальное время обслуживание</td>
                <td>Действие</td>
            </tr>
            <tr ng-repeat="servisPoint in servisPoints">
                <td>{{servisPoint.wayPoint+1}}</td>
                <td>{{servisPoint.taskTime}} мин</td>
                <td>
                    <input ng-model="servisPoint.stopTime" ng-change="chenge($index, $event)" required type="number" class="promised-text-card">
                </td>
                <td><button ng-click="unbindPoint($index, $event)" class="btn btn-primary btn-sm">Отвязать от стопа</button></td>
            </tr>
            </tbody>
        </table>
        <div class = "point-view-buttons">
            <button class="btn btn-primary btn-sm" ng-disabled="disabled" ng-click="confirm()">Подтвердить
            </button>
            <button class="btn btn-primary btn-sm" ng-click="cancel()">Отменить
            </button>
        </div>
    </div>
    <div class="stopWithOutPoints" ng-show="stopWithOutPoints">
        К данному стопу не привязана ни одна точка
    </div>
</div>


<!-- див для оповещений -->
<div ng-controller="NotificationController" ng-show="popupShow">
    <div id="notification">
        <div>[[текст оповещения]]</div>
    </div>
    <div id="ConfirmchengeCoord">
        <div>[[текст оповещения]]</div>
        <input type="checkbox" ng-model="gpsConfirmation" ng-checked="false" id="check"/>Подтверждаете новые координаты GPS данными?
        <button ng-click="chengeCoordPoint('true')" >OK</button>
        <button ng-click="chengeCoordPoint('false')">Отмена</button>
    </div>
</div>