<!-- получение объекта родительской формы из 1С -->
<script type="text/javascript">
    var parentForm;
    function initialize(thisForm) {
        parentForm = thisForm;
        //console.log('initialize complete', parentForm);
    }
</script>

<!-- файлы стилей -->
<link type="text/css" rel="stylesheet" href="./css/goldenlayout-base.css"/>
<link type="text/css" rel="stylesheet" href="./css/goldenlayout-light-theme.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css"/>
<link rel="stylesheet" href="./css/font-awesome.min.css"/>
<link rel="stylesheet" href="./css/application.css"/>
<link rel="stylesheet" href="./css/columns.css"/>
<link rel="stylesheet" href="./css/bootstrap.css"/>
<!--<link rel="stylesheet" href="./css/learning.css"/>-->


<!-- библиотеки -->
<script src="./js/vendor/jquery-2.1.4.min.js"></script>
<script src="./js/vendor/jquery-ui.min.js"></script>
<script src="./js/vendor/angular.js"></script>
<script src="./js/vendor/bootstrap.min.js"></script>
<script src="./js/vendor/goldenlayout.js"></script>
<script src="./js/vendor/bootstrap-contextmenu.js"></script>
<script src="./bower_components/angular-smart-table/dist/smart-table.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
<script src="https://cdn.rawgit.com/vast-engineering/jquery-popup-overlay/1.7.10/jquery.popupoverlay.js"></script>
<script src="./js/vendor/colResizable-1.5.min.js"></script>
<script src="./js/vendor/divicon.js"></script>
<script src="./js/vendor/oms.min.js"></script>
<script src="./js/vendor/leaflet.polylineDecorator.js"></script>
<!--Layout-->
<script src="./js/vendor/jquery.layout.min.js"></script> <!--include layout-->
<script src="./js/vendor/jquery.layout_and_plugins.min.js"></script>


<script src="./js/vendor/leaflet.polylineDecorator.js"></script>

<!-- скрипты Ангуляра  -->
<script src="./js/app.js"></script>

<script src="./js/controllers/point-index-controller.js"></script>
<script src="./js/controllers/map-controller.js"></script>
<script src="./js/controllers/notification-controller.js"></script>
<script src="./js/controllers/setting-controller.js"></script>
<script src="./js/controllers/point-view-controller.js"></script>
<script src="./js/controllers/edit-route-controller.js"></script>
<script src="./js/controllers/close-day-controller.js"></script>
<script src="./js/controllers/point-popup-edit-controller.js"></script>

<script src="./js/filters/mtm-unique.js"></script>

<script src="./js/directives/finish-render.js"></script>
<script src="./js/directives/right-click.js"></script>
<script src="./js/directives/enter-event.js"></script>

<script src="./js/services/settings.js"></script>
<script src="./js/services/statuses.js"></script>
<script src="./js/services/time-converter.js"></script>
<!--<script src="./js/learning/learning.js"></script>-->
<!--<script src="./js/learning/lessons.js"></script>-->


<!-- карта на фоне -->
<div id="map"></div>

<!-- полупрозрачное окно для отображения карты -->




<!--<div ng-show="true" ng-controller="MapController" class="section" id="edittime" style="position: absolute; left: 50px; top:350px; opacity: 100; background: dimgrey" >-->
    <!--Stop № {{currentStop[0]}}: {{currentStop[1]}} - {{currentStop[2]}} duration {{currentStop[3]}} <br>-->

    <!--<div ng-repeat="point in pointsToEdit" >-->
        <!--{{point[0]}}-->
        <!--{{point[1]}} - {{point[2]}}-->
        <!--<input type="text">-->
    <!--</div>-->
    <!--&lt;!&ndash;x point 07 09.00 : 13.00 <input type="text"> <br>&ndash;&gt;-->
    <!--&lt;!&ndash;x point 09 09.00 : 12.30 <input type="text"> <br>&ndash;&gt;-->
    <!--&lt;!&ndash;x point 11 09.00 : 12.30 <input type="text"> <br>&ndash;&gt;-->
    <!--<button ng-click="hideForm()">Confirm</button>-->

<!-- </div> -->



<!--div id = "test-popup" ng-controller = "CloseDayController" ng-show = "view">Test-popup</div-->
<!-- таблица точек доставки -->
<template type="text/html" id="template-point-table">
    <div ng-controller="PointIndexController" class="section" id="point-controller-container">
        <!-- меню -->
        <!-- Пока не выводим для пользователя, так как не реализован функционал -->
        <div id="point-menu-panel" >
            <div>
                <select id="status-select" ng-model="filters.status" class="group-select"
                        ng-options='option.value as option.name for option in filters.statuses'
                        <!--ng-click=""-->
                        >
                </select>

                <!--
                <select id="route-select" ng-model="filters.route" class="group-select"
                        ng-options='option.value as option.name for option in filters.routes'>
                </select>
                -->

                <select ng-show="false" id="branch-select" ng-model="filters.branch" class="group-select"
                        ng-options='option.value as option.name for option in filters.branches'>
                </select>

                <span></span>
                <!--
                <select id="draw-mode-select" ng-model="draw_mode" class="group-select"
                        ng-options='option.value as option.name for option in draw_modes'>
                </select>
                -->
                <input ng-show="false" id="draw-stops" type="checkbox" checked title="Отображать стопы"/>
                <input ng-show="false" id="draw-pushes" type="checkbox" title="Отображать моб. нажатия"/>
                <button ng-show="false" class="btn btn-info btn-sm" ng-click="drawRoute()">отрисовать</button>

                <button ng-show="false" class="btn btn-info btn-sm" id="force-load-btn" ng-click="forceLoad()">
                    загрузить
                </button>

                <button ng-show="true" class="btn btn-default btn-sm btn-success" id="problem-index-btn" ng-click="toggleProblemPoints()">
                    проблемные
                </button>

                <input ng-show="true" id="fast-calc" type="checkbox" value="false" ng-model="fastCalc" checked title="Упрощенный расчет данных">Быстрый расчет</input>

                <button ng-show="false" class="btn btn-default btn-sm" id="promised-15m-btn" ng-click="togglePromised15MPoints()">
                    {{params.endWindowSize * 5}} минут до закрытия
                </button>
                <button ng-show="false" class="btn btn-default btn-sm1"  id="test" ng-click="testbutton()" >
                     Кнопка ТЕСТ
                </button>
                <br>
                <input ng-show="false" id="search-input" type="text" size="15" enter-event="setTextFilter()"/>
                <button ng-show="false" class="btn btn-info btn-sm filter-btn" ng-click="setTextFilter()">
                    <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                </button>

                <button ng-show="false" class="btn btn-info btn-sm filter-btn" id="cancel-filter-btn" ng-click="cancelTextFilter()">
                    <span class="glyphicon glyphicon glyphicon-remove" aria-hidden="true"></span>
                </button>
            </div>
        </div>









        <!-- таблица точек -->
        <div id="point-table" class="table-holder">


            <table class="table table-striped point-table" id="point-table-tbl"
                   st-safe-src="rowCollection" st-table="displayCollection">
                <thead class="header">
                <tr class="titles-tr">
                    <th class="number-col" title="Плановый номер задания">План</th>

                    <th class="driver-name-col" title="Фамилия и имя водителя">Водитель</th>
                    <th class="client-name-col" title="Название точки доставки">Название</th>
                    <th class="gps-conf-col" title="Подтверждение точки GPS">GPS</th>
                    <th class="address-col" title="Адрес доставки">Адрес</th>
                    <th class="status-col"  title="Статус доставки">
                        <button ng-click="order('status')"  >Статус</button>
                    </th>
                    <th class="window-type-col" title="Фактическое окно доставки">Факт. окно</th>
                    <th class="stop-col" title="Наличие стопа связанного с точкой">Стоп</th>
                    <th class="mobile-push-col" title="Наличие нажатия с мобильного приложения">Моб.нажатие</th>
                    <th class="plan-arrival-time-col" title="Плановое прибытие на точку">План. прибытие</th>
                    <th class="time-window-col" title="Заказанное клиентом окно">Заказанное</th>
                    <th class="time-left-window-col" title="JОстаток до конца контролируемого окна">Ост. КОК</th>
                    <th class="prediction-arrival-time-col" title="Прогнозируемое время прибытия">Прогноз прибытия</th>
                    <th class="prediction-arrival-left-col"
                        title="Осталось до прогнозируемого времени прибытия" >
                        <button ng-click="order('arrival_left_prediction')">Осталось до прибытия</button>
                    </th>
                    <th class="real-arrival-time-col" title="Фактическое время прибытия">Факт. прибытие</th>

                    <th class="overdue-col" title="Размер опоздания от планового времени прибытия">Опазд.</th>
                    <th class="problem-index-col"  title="Индекс проблемности задания">
                        <button ng-click="order('problem_index')">Проблемность</button>
                    </th>
                    <th class="promised-window-col" title="Обещанное клиенту окно">Обещ. окно</th>
                    <!--<th class="promised-window-changed-col" title="Редактируемое обещанное окно">Редакт. окно</th>-->
                    <th class="promised-window-changed-col" title="Количество переносов">Кол. переносов</th>
                    <th class="driver-phone-col" title="Телефон водителя">Тел. водителя</th>
                    <th class="car-number-col" title="Номер машины">Номер</th>
                    <th class="car-type-col" title="Назавание машины">Машина</th>
                    <th class="branch-col" title="Филиал">Филиал</th>
                    <th title="Комментарий к точке">Комментарий</th>
                </tr>
                </thead>

                <thead class="header-copy">
                <tr class="titles-tr">
                    <th class="number-col" title="Плановый номер задания">План</th>

                    <th class="driver-name-col" title="Фамилия и имя водителя">Водитель</th>
                    <th class="client-name-col" title="Название точки доставки">Название</th>
                    <th class="gps-conf-col" title="Подтверждение точки GPS">GPS</th>
                    <th class="address-col" title="Адрес доставки">Адрес</th>
                    <th class="status-col"  title="Статус доставки">
                        <button ng-click="order('status')"  >Статус</button>
                    </th>
                    <th class="window-type-col" title="Фактическое окно доставки">Факт. окно</th>
                    <th class="stop-col" title="Наличие стопа связанного с точкой">Стоп</th>
                    <th class="mobile-push-col" title="Наличие нажатия с мобильного приложения">Моб.нажатие</th>
                    <th class="plan-arrival-time-col" title="Плановое прибытие на точку">План. прибытие</th>
                    <th class="time-window-col" title="Заказанное клиентом окно">Заказанное</th>
                    <th class="time-left-window-col" title="JОстаток до конца контролируемого окна">Ост. КОК</th>
                    <th class="prediction-arrival-time-col" title="Прогнозируемое время прибытия">Прогноз прибытия</th>
                    <th class="prediction-arrival-left-col"
                        title="Осталось до прогнозируемого времени прибытия" >
                        <button ng-click="order('arrival_left_prediction')">Осталось до прибытия</button>
                    </th>
                    <th class="real-arrival-time-col" title="Фактическое время прибытия">Факт. прибытие</th>

                    <th class="overdue-col" title="Размер опоздания от планового времени прибытия">Опазд.</th>
                    <th class="problem-index-col"  title="Индекс проблемности задания">
                        <button ng-click="order('problem_index')">Проблемность</button>
                    </th>
                    <th class="promised-window-col" title="Обещанное клиенту окно">Обещ. окно</th>
                    <!--<th class="promised-window-changed-col" title="Редактируемое обещанное окно">Редакт. окно</th>-->
                    <th class="promised-window-changed-col" title="Количество переносов">Кол. переносов</th>
                    <th class="driver-phone-col" title="Телефон водителя">Тел. водителя</th>
                    <th class="car-number-col" title="Номер машины">Номер</th>
                    <th class="car-type-col" title="Назавание машины">Машина</th>
                    <th class="branch-col" title="Филиал">Филиал</th>
                    <th title="Комментарий к точке">Комментарий</th>
                </tr>
                </thead>

                <tbody>
                <!-- заменил ng-show="applyFilter(row)" на ng-if="applyFilter(row)" -->
                <tr ng-repeat="row in displayCollection | orderBy : myFilter" id="{{::'point-' + row.row_id}}"
                    ng-click="rowClick(row)"
                    ng-dblclick="dblRowClick(row)"
                    ng-show="applyFilter(row)"
                    on-finish-render="ngRepeatFinished"  class="delivery-point-row"
                    ng-class="{'row-red': row.locked, 'row-green' : row.lockedByMe}">

                    <td>{{row.NUMBER}}</td>
                    <!--<td title="{{::row.transport.NAME}}">{{::row.transport.NAME}}</td>-->
                    <td>{{row.driver.NAME}}</td>
                    <td title="{{row.waypoint.NAME}}">{{row.waypoint.NAME}}</td>
                    <td title="{{row.waypoint.CONFIRMBYGPS}}">{{row.waypoint.CONFIRMBYGPS =="true" ? "Есть":"Нет"}}</td>
                    <td title="{{row.waypoint.ADDRESS}}">{{row.waypoint.ADDRESS}}</td>
                    <td id="{{'status-td-' + row.row_id}}">
                        {{getTextStatus(row.status, row.row_id, row.confirmed, row.driver.NAME)}}
                    </td>
                    <td id="{{'window-td-' + row.row_id}}">{{getTextWindow(row.windowType, row.row_id)}}</td>
                    <td>{{row.haveStop ? 'Есть' : ''}}</td>
                    <td id="{{'push-td-' + row.row_id}}"
                        title="{{ row.mobile_push ? ('время: ' + row.mobile_push.time + '\n' +
                                'время gps: ' + row.mobile_push.gps_time + '\n' +
                                'расстояние до точки: ' + row.mobile_push.distance + ' м') : ''}}">
                        {{((getPushStatus(row)).substr(-8)).substring(0,5)}}
                    </td>
                    <td>{{row.arrival_time_ts * 1000 | date:'HH:mm'}}</td>
                    <td>{{row.AVAILABILITY_WINDOWS}}</td>
                    <td>{{(row.end_time_ts - nowTime)>0 && (row.real_arrival_time == 0 || row.real_arrival_time == undefined) ? (parseInt((row.end_time_ts - nowTime)/3600) +'ч.' + parseInt((parseInt(((row.end_time_ts - nowTime) -(parseInt((row.end_time_ts - nowTime)/3600))*3600 )))/60)) + 'м.' : ""  }}</td>

                    <td>
                        <span ng-show="row.arrival_prediction > 0">
                            {{row.arrival_prediction * 1000 | date:'HH:mm' }}
                        </span>
                    </td>
                    <td>
                        <span ng-show="row.arrival_prediction > 0">
                            {{row.arrival_left_prediction * 1000 | date:'HH:mm' : 'UTC' }}
                        </span>
                    </td>
                    <td>
                        <span ng-show="row.real_arrival_time > 0">
                            {{row.real_arrival_time * 1000 | date:'HH:mm' }}
                        </span>
                    </td>
                    <td>
                        <span ng-show="row.overdue_time > 0">
                            {{row.overdue_time * 1000 | date:'HH:mm' : 'UTC'}}
                        </span>
                    </td>
                    <td>{{row.problem_index}}</td>
                    <td>
                        {{row.promised_window.start * 1000 | date:'HH:mm'}} -
                        {{row.promised_window.finish * 1000 | date:'HH:mm'}}
                    </td>
                    <!--<td>-->
                        <!--<input type="text" class="promised-text" id="{{'edit-promised-start-' + row.row_id}}"-->
                               <!--value="{{row.promised_window_changed.start * 1000 | date:'HH:mm'}}"-->
                               <!--enter-event="changePromisedWindow(row.row_id)">-->
                        <!--</input> - -->
                        <!--<input type="text" class="promised-text" id="{{'edit-promised-finish-' + row.row_id}}"-->
                               <!--value="{{row.promised_window_changed.finish * 1000 | date:'HH:mm'}}"-->
                               <!--enter-event="changePromisedWindow(row.row_id)">-->
                        <!--</input>-->
                    <!--</td>-->
                    <td> {{row.change_time ? row.change_time : 0}}</td>
                    <td>{{row.driver.PHONE}}</td>
                    <td>{{row.transport.REGISTRATION_NUMBER}}</td>
                    <td title="{{row.transport.NAME}}">{{row.transport.NAME}}</td>
                    <td>{{row.branchName}}</td>
                    <td title="{{row.waypoint.COMMENT}}">{{row.waypoint.COMMENT}}</td>
                </tr>
                </tbody>
            </table>

            <div id="context-menu">
                <ul class="dropdown-menu" role="menu">
                    <li><a tabindex="-1" data-menu-option="sort">Вкл/Выкл фильтр по маршруту</a></li>
                    <li><a tabindex="-1" data-menu-option="edit">Редактировать маршрут</a></li>
                </ul>
            </div>
        </div>
    </div>
</template>

<!-- прозрачное окно для отображения карты -->
<template type="text/html" id="transparent-map-window">
    <div class="section" ng-controller="MapController" id="transparent-map-holder">
        transparent-map-window
    </div>
</template>




<!-- панель настроек -->
<template type="text/html" id="setting-window">
    <div class="section setting-panel" ng-controller="SettingController">
        <div class="button-row">
            <button class="btn btn-info btn-sm" ng-click="saveAllParams()">Сохранить</button>
        </div>

        <div class="block" ng-show="demoMd" id="demo-setting">
            <div class="title">Настройки демо-режима</div>
            <div class="setting-row">
                <span class="param-title">Время в демо-режиме</span>
                <input type="range" min="0" max="168" ng-model="params.demoTime"/>
                {{(startDemoTime + 300 * params.demoTime) * 1000 | date:'HH:mm'}}
            </div>
        </div>

        <div class="block">
            <div class="title">Настрока типа рабочего окна</div>
            <div class="setting-row">
                <span class="param-title">Тип рабочего окна</span>
                <select ng-model="params.workingWindowType" class="group-select"
                        ng-options='option.value as option.name for option in workingWindowTypes'>
                </select>
            </div>
        </div>

        <div class="block">
            <div class="title">Настройка фильтра невыполненных доставок на краю рабочего окна</div>
            <div class="setting-row">
                <span class="param-title">Размер фильтра (минуты)</span>
                <input type="range" min="1" max="24" ng-model="params.endWindowSize"/>
                {{params.endWindowSize * 5}}
            </div>
        </div>

        <div class="block">
            <div class="title">Настройка автопривязки привязки стопов и моб.нажатий</div>
            <div class="setting-row">
                <span class="param-title">Радиус автопривязки стопов</span>
                <input type="range" min="10" max="500" ng-model="params.stopRadius"/>
                {{params.stopRadius}}
            </div>
            <div class="setting-row">
                <span class="param-title">Радиус автопривязки моб.нажатий</span>
                <input type="range" min="10" max="500" ng-model="params.mobileRadius"/>
                {{params.mobileRadius}}
            </div>
            <div class="setting-row">
                <span class="param-title">Временное смещение стопа (минуты)</span>
                <input type="range" min="10" max="480" ng-model="params.timeThreshold"/>
                {{params.timeThreshold}}
            </div>
        </div>

        <div class="block">
            <div class="title">Настройки коэффициентов индекса проблемности</div>
            <div class="setting-row">
                <span class="param-title">Влияние прогнозного опоздания</span>
                <input type="range" min="0" max="100" ng-model="params.predictMinutes"/>
                {{params.predictMinutes / 10}}
            </div>
            <div class="setting-row">
                <span class="param-title">Влияние фактического опоздания</span>
                <input type="range" min="0" max="100" ng-model="params.factMinutes"/>
                {{params.factMinutes / 10}}
            </div>
            <div class="setting-row">
                <span class="param-title">Влияние объема</span>
                <input type="range" min="0" max="100" ng-model="params.volume"/>
                {{params.volume / 10}}
            </div>
            <div class="setting-row">
                <span class="param-title">Влияние веса</span>
                <input type="range" min="0" max="100" ng-model="params.weight"/>
                {{params.weight / 10}}
            </div>
            <div class="setting-row">
                <span class="param-title">Влияние стоимости</span>
                <input type="range" min="0" max="100" ng-model="params.value"/>
                {{params.value / 10}}
            </div>
        </div>

        <div class="block">
            <div class="title">Загрузка конкретного дня</div>
            <div class="setting-row">
                <span class="param-title">Отображаемый день</span>
                <input type="date" id="show-date"/>
            </div>
        </div>
    </div>
</template>

<!-- панель редактирования маршрута Пока закомментирована -->


<template   type="text/html" id="edit-route">
    <div id="edit-panel" ng-controller="EditRouteController">
        <div ng-show="route == undefined" id="edit-panel-empty">
            Маршрут для редактирования не выбран
        </div>

        <!-- меню -->
        <div id="edit-panel-menu" ng-show="route !== undefined">
            <select id="recalc-mode-select" ng-model="recalc_mode" class="group-select"
                    ng-options='option.value as option.name for option in recalc_modes'>
            </select>

            <button class="btn btn-info btn-sm" id="to-recalculate-btn" ng-click="recalculateRoute()">
                пересчитать
            </button>

            <button class="btn btn-info btn-sm" ng-click="saveRoutes()">сохранить</button>

            <button class="btn btn-info btn-sm" ng-click="cancelEdit()">отменить</button>
        </div>

        <!-- оригинальный маршрут до изменений -->
        <div ng-show="route !== undefined">
            <div id="original-route">
                <div class="block-title">Плановый маршрут</div>
                <div>
                    <div ng-repeat="box in originalBoxes" class="box" style="width: {{box.width}}px;"
                         ng-class="{'task-box': box.type == BOX_TYPE.TASK,
                                    'travel-box': box.type == BOX_TYPE.TRAVEL,
                                    'downtime-box': box.type == BOX_TYPE.DOWNTIME,
                                    'too-big-box': box.tooBig,
                                    'finished-box': box.status == STATUS.FINISHED
                                                    || box.status == STATUS.FINISHED_TOO_EARLY
                                                    || box.status == STATUS.FINISHED_LATE,
                                    'warehouse-box': box.warehouse}"
                         title="{{tooltip(box)}}">
                        {{box.warehouse ? 'СКЛАД (' + box.number + ')' : box.number}}
                        <span ng-show="box.tooBig">
                            <span class="glyphicon glyphicon-menu-right"></span>
                            <span class="glyphicon glyphicon-menu-right"></span>
                            <span class="glyphicon glyphicon-menu-right"></span>
                        </span>
                    </div>
                </div>
            </div>

            <!-- изменяемая копия маршрута -->
            <div id="changed-route">
                <div class="block-title">Измененный маршрут</div>
                <div id="boxes">
                    <div ng-repeat="box in changebleBoxes" class="box droppable-box" style="width: {{box.width}}px;"
                         ng-class="{'task-box': box.type == BOX_TYPE.TASK,
                                    'draggable-box': box.type == BOX_TYPE.TASK && !box.warehouse,
                                    'travel-box': box.type == BOX_TYPE.TRAVEL,
                                    'downtime-box': box.type == BOX_TYPE.DOWNTIME,
                                    'late-box': box.late,
                                    'too-big-box': box.tooBig,
                                    'warehouse-box': box.warehouse}"
                         title="{{tooltip(box)}}"
                         data-index="{{box.index}}"
                         id="box-{{box.type}}-{{box.index}}"
                         ng-dblclick="boxDblClick(box.waypointNumber)">
                        {{box.warehouse ? 'СКЛАД (' + box.number + ')' : box.number}}
                        <span ng-show="box.tooBig">
                            <span class="glyphicon glyphicon-menu-right"></span>
                            <span class="glyphicon glyphicon-menu-right"></span>
                            <span class="glyphicon glyphicon-menu-right"></span>
                        </span>
                    </div>
                    <!--<div class="box end-box droppable-box" data-index="55555">END</div>-->
                </div>
            </div>
        </div>

    </div>
</template>

<!-- панель закрытия дня -->
<template type="text/html" id="close-day" >
    <!-- полупрозрачное окно для затемнения таблицы -->
    <div class="close-day-wrapper" >
        <div class="title"  ng-show="clickOff" id="transparent-closeday-window" ></div>

        <div id="close-day-panel" ng-controller = "CloseDayController" >
            <button ng-click = "showCheckBoxToClose()">Готовые к закрытию</button>
            <button ng-click = "closeDayClick()" ng-disabled="disabledBtnCloseDay">Закрыть выбранные</button>

            <!--Имя компании: {{companyName}},-->
            <!--Время: {{(serverTime*1000) | date:"HH:MM"}}.-->

            <div>
                  Ответственный: {{user}},
                  Дата :{{(serverTime*1000) | date:"dd.MMMM.y"}}

            </div>
            <div>
                <table>
                    <tr>
                        <th><!--input id="main-checkbox" ng-click = "showCheckBoxToClose()" type="checkbox" ng-checked = "setCheckAll" ng-model = "getCheckAll"-->
                            <button ng-click="orderCloseDay('getCheck')">Все</button></th>
                        <th><button ng-click="order('filterId'); orderCloseDay('getCheck')" >ID</button></th>
                        <th><button ng-click="order('driver.NAME'); orderCloseDay('getCheck')">Водитель</button></th>
                        <th><button ng-click="order('transport.NAME'); orderCloseDay('getCheck')">Машина</button></th>
                        <!--th>Старт</th-->
                        <th class="center">Старт</th>
                        <th><button ng-click="order('END_TIME');">Финиш</button></th>
                        <th><button ng-click="order('(real_track[real_track.length-1].t2)');">GPS сигнал</button></th>

                    </tr>
                    <tr  ng-class="$index == selected ? 'driver-select-bg' : ''" class = "close-table-row" ng-repeat="item in data.routes | filter: { getCheck: false } " ng-click = "closeTableRowClick(item.uniqueID, $index)">
                        <td><input ng-click = "toggleCheckBoxToClose()"
                                   id = "close-table-checkbox-{{item.filterId}}"
                                   type="checkbox"
                                   ng-model="item.getCheck"
                                   ng-disabled="true">
                        </td>
                        <td>{{item.filterId+1}}</td>
                        <td id = "close-table-driver-{{item.filterId}}">{{item.driver.NAME}}</td>
                        <td >{{item.transport.NAME}}</td>


                        <td>{{item.START_TIME.split(' ')[0].substring(0,5)}} {{item.START_TIME.split(' ')[1]}} -&nbsp;</td>
                        <td> {{ item.END_TIME.split(' ')[1]}}</td>
                        <td> {{ (item.real_track == undefined || item.real_track == 0) ? "No signal": ((item.real_track[item.real_track.length-1].t2)*1000) | date :'dd.MM HH:mm' }}</td>
                    </tr>


                    <tr>
                        <td colspan="3" >
                            <select ng-model="selectDeyOldRoutes"
                                    ng-show="showSelectDayOldRoutes"
                                    ng-change="chengeSelectDayOldRoutes()"
                                    ng-options="day as day  for day in deysOldRoutes"
                                    class="seleOldRoute">
                                <option value="" selected="selected">У вас есть не закрытые дни</option>
                            </select>
                        </td>
                        <td colspan="2" >
                            <button ng-click="getCurrentday()" ng-show="showGetCurrentday">Вернуться в текущий день</button>
                        </td>
                    </tr>

                    <tr  ng-class="$index == selected ? 'driver-select-bg' : ''" class = "close-table-row" ng-repeat="item in data.routes | filter: { getCheck: true } " ng-click = "closeTableRowClick(item.uniqueID, $index)">
                        <td><input ng-click = "toggleCheckBoxToClose()"
                                   id = "close-table-checkbox-{{::item.filterId}}"
                                   type="checkbox"
                                   ng-model="item.getCheck"
                                   ng-disabled="true">
                        </td>
                        <td>{{item.filterId}}</td>
                        <td id = "close-table-driver-{{::item.filterId}}">{{::item.driver.NAME}}</td>
                        <td class="center">{{item.transport.NAME}}</td>


                        <td>{{item.START_TIME.split(' ')[0].substring(0,5)}} {{item.START_TIME.split(' ')[1]}} - </td>
                        <td> {{item.END_TIME.split(' ')[1]}}</td>
                        <td> {{ (item.real_track == undefined || item.real_track == 0) ? "No signal": ((item.real_track[item.real_track.length-1].t2)*1000) | date :'dd.MM HH:mm'}}</td>
                    </tr>


                </table>
            </div>


            <!-- Визуальная часть закрытия дня -->
        </div>
    </div>
</template>

<!-- див для оповещений -->
<div ng-controller="NotificationController">
    <div id="notification">
        <div>[[текст оповещения]]</div>
    </div>
    <div id="ConfirmchengeCoord">
        <div>[[текст оповещения]]</div>
            <input type="checkbox" ng-model="gpsConfirmation" ng-checked="false" id="check"/>Подтверждаете новые координаты GPS данными?
            <button ng-click="chengeCoordPoint('true')" >OK</button>
            <button ng-click="chengeCoordPoint('false')">Отмена</button>
    </div>
</div>

<!-- див для отображения окна точки -->
<div id="point-view" ng-controller="PointViewController">
    <div class="card-title">
        Карточка задания
        <button class="btn btn-primary btn-sm"
                ng-show="companyName == 'IDS'"
                ng-click="open1CWindow()">Открыть в 1С
        </button>
    </div>

    <table id="point-view-table" class="table table-striped">
        <tbody>
        <tr>
            <td class="title">Название:</td>
            <td class="row-data">{{point.waypoint.NAME}}</td>
        </tr>


        <tr>
            <td class="title">Адрес:</td>
            <td class="row-data">{{point.waypoint.ADDRESS}}</td>
        </tr>
        <tr>
            <td class="title">План. прибытие:</td>
            <td class="row-data">{{point.arrival_time_ts * 1000 | date:'HH:mm'}}</td>
        </tr>
        <tr>
            <td class="title">План. номер:</td>
            <td class="row-data">{{point.NUMBER}}</td>
        </tr>


        <tr>
            <td class="title">Машина:</td>
            <td class="row-data">{{point.transport.NAME}}</td>
        </tr>
        <tr>
            <td class="title">Водитель:</td>
            <td class="row-data">{{point.driver.NAME}}</td>
        </tr>
        <tr>
            <td class="title">Окно доступности</td>
            <td class="row-data">{{point.waypoint.AVAILABILITY_WINDOWS}}</td>
        </tr>

        <tr>
            <td class="title">Заказанное окно:</td>
            <td class="row-data">{{point.AVAILABILITY_WINDOWS}}</td>
        </tr>
        <tr>
            <td class="title">Обещанное окно:</td>
            <td class="row-data">
                {{point.promised_window.start * 1000 | date:'HH:mm'}} -
                {{point.promised_window.finish * 1000 | date:'HH:mm'}}
            </td>
        </tr>
        <tr>
            <td class="title">Контролируемое окно:</td>
            <td class="row-data">
                <input type="text" class="promised-text-card" id="promised-start-card"
                       enter-event="changePromisedWindow(point)"> -
                <input type="text" class="promised-text-card" id="promised-finish-card"
                       enter-event="changePromisedWindow(point)">
            </td>
        </tr>
        <tr>
            <td class="title">Тел. водителя:</td>
            <td class="row-data">{{point.driver.PHONE}}</td>
        </tr>
        <tr>
            <td class="title">Комментарий:</td>
            <td class="row-data">{{point.waypoint.COMMENT}}</td>
        </tr>
        <tr>
            <td class="title">Статус:</td>
            <td class="row-data">
                {{point.textStatus}}

                <div ng-show="showHideSeasonButtons"> Доставку
                <button id="confirm-status-task-btn"
                        ng-disabled="selectReasonList"

                        class="btn btn-primary btn-sm" ng-click="confirmStatus()">Подтвердить
                </button>
                    <br>
                <select ng-model="selectReasonList"
                        ng-options="item.attributes.id as item.attributes.name  for item in loadReasonList">
                    <option value="" selected>--Причина отказа--</option>
                </select>
                <button id="cancel-status-task-btn"
                        ng-disabled="!selectReasonList"

                        class="btn btn-primary btn-sm" ng-click="cancelTask()">Отменить
                </button>
                </div>
            </td>
        </tr>
        <!--<tr>-->
            <!--<td class="title">Окно:</td>-->
            <!--<td class="row-data">{{point.AVAILABILITY_WINDOWS}}</td>-->
        <!--</tr>-->
        <tr>
            <td class="title">Стоимость:</td>
            <td class="row-data">{{point.VALUE}}</td>
        </tr>
        <tr>
            <td class="title">Объем:</td>
            <td class="row-data">{{point.VOLUME}}</td>
        </tr>
        <tr>
            <td class="title">Вес:</td>
            <td class="row-data">{{point.WEIGHT}}</td>
        </tr>
        </tbody>
    </table>

    <div id="point-view-setting" ng-show="locked(point)">
        <!--
        <button id="lock-route-btn" class="btn btn-primary btn-sm down-btn"
                ng-class="point.lockedRoute ? 'btn-danger' : 'btn-primary'" ng-click="toggleRouteBlock()">
            <i class="fa fa-md" ng-class="point.lockedRoute ? 'fa-lock' : 'fa-unlock'"></i>
            &nbsp;Машрут
        </button>
        <button id="edit-task-btn" class="btn btn-sm down-btn"
                ng-class="point.locked ? 'btn-danger' : 'btn-primary'" ng-click="toggleTaskBlock()">
            <i class="fa fa-md" ng-class="point.locked ? 'fa-lock' : 'fa-unlock'"></i>
            &nbsp;Задание
        </button>

        <button id="cancel-task-btn" class="btn btn-danger btn-sm down-btn" ng-click="cancelTask()">Отменить задание
        </button>
        -->
    </div>
</div>
<!--Окошко для редактирования точек и времени-->

<div id="point-editing-popup" ng-controller="PointPopupEditController" style="position: absolute; visibility: hidden">

        <div class="card-title">
            <div id="container">
                <div class = "row">
                    <div class = "col-md-3">
                    </div>
                    <div class = "col-md-6">
                        Карточка остановки
                    </div>
                    <div class = "col-md-3">
                        <button id="btn-close" class="btn btn-danger" ng-click="cancel()">Закрыть
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div>
            <table id="stop-info-table" >
                <tbody>
                <tr class="stop-table-title">
                    <td>Номер стопа</td>
                    <td>Время начала</td>
                    <td>Время окончания</td>
                    <td>Продолжительность</td>
                </tr>
                <tr>
                    <td class="row-data">{{stopIndx}}</td>
                    <td class="row-data">{{start*1000 | date: "HH:mm"}}</td>
                    <td class="row-data">{{fin*1000 | date: "HH:mm"}}</td>
                    <td class="row-data">{{(delta/60)}} мин</td>
                </tr>
                </tbody>
            </table>
        </div>
    <div ng-show="stopWithPoints" >
        <table id="stop-point-view-table">
            <tbody>
            <tr class="stop-table-title">
                <td class="title">Точка доставки:</td>
                <td class="title">Плановое время обслуживания</td>
                <td class="title">Реальное время обслуживание</td>
                <td>Действие</td>
            </tr>
            <tr ng-repeat="servisPoint in servisPoints">
                <td>{{servisPoint.wayPoint+1}}</td>
                <td>{{servisPoint.taskTime}} мин</td>
                <td>
                    <input ng-model="servisPoint.stopTime" ng-change="chenge($index, $event)" required type="number" class="promised-text-card">
                </td>
                <td><button ng-click="unbindPoint($index, $event)" class="btn btn-primary btn-sm">Отвязать от стопа</button></td>
            </tr>
            </tbody>
        </table>
        <div class = "point-view-buttons">
            <button class="btn btn-primary btn-sm" ng-disabled="disabled" ng-click="confirm()">Подтвердить
            </button>
            <button class="btn btn-primary btn-sm" ng-click="cancel()">Отменить
            </button>
        </div>
    </div>
    <div class="stopWithOutPoints" ng-show="stopWithOutPoints">
        К данному стопу не привязана ни одна точка
    </div>
</div>
